
## ADNL TCP + Liteserver
This is the lower level protocol on which all interaction in the TON network is built, it can work on top of any protocol, but is most often used on top of TCP and UDP. UDP is used for communication between nodes, and TCP is used for communication with lite servers.

Now we will analyze ADNL running over TCP and learn how to interact with light servers directly.

In the TCP version of ADNL, network nodes use public keys ed25519 as addresses and establish a connection using a shared key obtained using the Elliptic Curve Diffie-Hellman procedure - ECDH.


### Package Structure
Each ADNL TCP packet, except for the handshake, has the following structure:
* 4 bytes of packet size in little endian (N)
* 32 bytes nonce [[?]](## "Random bytes to protect against checksum attacks")
* (N - 64) payload bytes
* 32 bytes SHA256 checksum from nonce and payload

The entire packet, including the size, is **AES-CTR** encrypted.
After decryption, it is necessary to check whether the checksum matches the data, to check, you just need to calculate the checksum yourself and compare the result with what we have in the package.

The handshake packet is an exception, it is transmitted in a partially clear form and is described in the next chapter.


### Establishing a connection
To establish a connection, we need to know the ip, port and public key of the server, and generate our own private and public key ed25519. 

Public server data such as ip, port and key can be obtained from the [config](https://ton-blockchain.github.io/global.config.json). IP in the config in numerical form, it can be brought to normal using, for example [this tool](https://www.browserling.com/tools/dec-to-ip). The public key in the config in base64 format.

The client generates 160 random bytes, some of which will be used by the parties as the basis for AES encryption.

Of these, 2 permanent AES-CTR ciphers are created, which will be used by the parties to encrypt / decrypt messages after the handshake.
* Cipher A - key 0 - 31 bytes, iv 64 - 79 bytes
* Cipher B - key 32 - 63 bytes, iv 80 - 95 bytes

The ciphers are applied in this order:
* Cipher A is used by the server to encrypt the messages it sends.
* Cipher A is used by the client to decrypt received messages.
* Cipher B is used by the client to encrypt the messages it sends.
* Cipher B is used by the server to decrypt received messages.

To establish a connection, the client must send a handshake packet containing:
* [32 bytes] **Server key ID** [[More]](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B0%D0%B9%D0%B4%D0%B8-%D0%BA%D0%BB%D1%8E%D1%87%D0%B0)
* [32 bytes] **Our public key is ed25519**
* [32 bytes] **SHA256 hash from our 160 bytes**
* [160 bytes] **Our 160 bytes encrypted** [[More]](#%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-handshake-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0)


When receiving a handshake packet, the server will do the same actions on itself, receive an ECDH key, decrypt 160 bytes and create 2 permanent keys. If everything works out, the server will respond with an empty ADNL packet, without payload, to decrypt which (as well as subsequent ones) you need to use one of the permanent ciphers. 

From this point on, the connection can be considered established.

## Data exchange
After we have established a connection, we can start receiving information; the TL language is used to serialize data.

[More about TL](/TL.md)

### Ping&Pong
It is optimal to send a ping packet about once every 5 seconds. This is necessary to maintain the connection while no data is being exchanged, otherwise the server will terminate the connection.

The ping packet, like all the others, is built according to the standard scheme described [above](#package-structure), and carries the request ID and ping ID as payload data.

Let's find the desired scheme for the ping request [here](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/ton_api.tl#L35) and calculate the scheme id as 
`crc32_IEEEE("tcp.ping random_id:long = tcp.Pong")`. When converted to little endian bytes, we get **9a2b084d**.

Thus, our ADNL ping packet will look like this:
* 4 bytes of packet size in little endian -> 64 + (4+8) = **76**
* 32 bytes nonce -> random 32 bytes
* 4 bytes of ID TL schema -> **9a2b084d**
* 8 bytes of request id -> random number uint64 
* 32 bytes of SHA256 checksum from nonce and payload

We send our packet and wait for [tcp.pong](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/ton_api.tl#L23), `random_id` will be equal to the one we sent to ping.

### Receiving information from a light server
All requests that are aimed at obtaining information from the blockchain are wrapped in [LiteServer Query](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L83) schema, which in turn is wrapped in [ADNL Query](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L22) schema.

LiteQuery:
`liteServer.query data:bytes = Object`, id **df068c79**

ADNLQuery:
`adnl.message.query query_id:int256 query:bytes = adnl.Message`, id **7af98bb4**

LiteQuery is passed inside ADNLQuery, as `query:bytes`, and the final query is passed inside LiteQuery, as `data:bytes`.

[Parsing encoding bytes in TL](/TL.md)

#### Getting payloads
Now, since we already know how to generate TL packets for the Lite API, we can request information about the current TON masterchain block. The masterchain block is used in many further requests as an input parameter to indicate the state (moment) in which we need information.

##### getMasterchainInfo
We are looking for the [TL schema we need](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L60), calculate its ID and build the package:

* 4 bytes of packet size in little endian -> 64 + (4+32+(1+4+(1+4+3)+3)) = **116**
* 32 bytes nonce -> random 32 bytes
* 4 bytes of ID ADNLQuery schema -> **7af98bb4**
* 32 bytes `query_id:int256` -> random 32 bytes
* * 1 byte array size -> **12**
* * 4 byte of ID LiteQuery schema -> **df068c79**
* * * 1 byte array size -> **4**
* * * 4 bytes of ID getMasterchainInfo schema -> **2ee6b589**
* * * 3 null bytes of padding (alignment to 8)
* * 3 null bytes of padding (alignment to 16)
* 32 bytes of checksum SHA256 from nonce and payload

Packet example in hex:
```
74000000                                                             -> packet size (116)
5fb13e11977cb5cff0fbf7f23f674d734cb7c4bf01322c5e6b928c5d8ea09cfd     -> nonce
  7af98bb4                                                           -> ADNLQuery
  77c1545b96fa136b8e01cc08338bec47e8a43215492dda6d4d7e286382bb00c4   -> query_id
    0c                                                               -> array size
    df068c79                                                         -> LiteQuery
      04                                                             -> array size
      2ee6b589                                                       -> getMasterchainInfo
      000000                                                         -> 3 bytes of padding
    000000                                                           -> 3 bytes of padding
ac2253594c86bd308ed631d57a63db4ab21279e9382e416128b58ee95897e164     -> sha256
```

In response, we expect to receive [liteServer.masterchainInfo](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L30), consisting of  last:[ton.blockIdExt](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/tonlib_api.tl#L51) state_root_hash:int256 Ð¸ init:[tonNode.zeroStateIdExt](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/ton_api.tl#L359).

The received packet is deserialized in the same way as the sent one - he same algorithm, but in the opposite direction, except that the response is wrapped only in [ADNLAnswer](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L23).

After decoding the response, we get a packet of the form:
```
20010000                                                                  -> packet size (288)
5558b3227092e39782bd4ff9ef74bee875ab2b0661cf17efdfcd4da4e53e78e6          -> nonce
  1684ac0f                                                                -> ADNLAnswer
  77c1545b96fa136b8e01cc08338bec47e8a43215492dda6d4d7e286382bb00c4        -> query_id (identical to request)
    b8                                                                    -> array size
    81288385                                                              -> liteServer.masterchainInfo
                                                                          last:tonNode.blockIdExt
        ffffffff                                                          -> workchain:int
        0000000000000080                                                  -> shard:long
        27405801                                                          -> seqno:int   
        e585a47bd5978f6a4fb2b56aa2082ec9deac33aaae19e78241b97522e1fb43d4  -> root_hash:int256
        876851b60521311853f59c002d46b0bd80054af4bce340787a00bd04e0123517  -> file_hash:int256
      8b4d3b38b06bb484015faf9821c3ba1c609a25b74f30e1e585b8c8e820ef0976    -> state_root_hash:int256
                                                                          init:tonNode.zeroStateIdExt 
        ffffffff                                                          -> workchain:int
        17a3a92992aabea785a7a090985a265cd31f323d849da51239737e321fb05569  -> root_hash:int256      
        5e994fcf4d425c0a6ce6a792594b7173205f740a39cd56f537defd28b48a0f6e  -> file_hash:int256
    000000                                                                -> 3 bytes of padding
520c46d1ea4daccdf27ae21750ff4982d59a30672b3ce8674195e8a23e270d21          -> sha256
```

##### runSmcMethod
We already know how to get the masterchain block, so now we can call any light server methods.
Let's analyze **runSmcMethod** - this is a method that calls a function from a smart contract and returns a result.  Here we need to understand some new data types such as [TL-B](/TL-B.md), [Cell](https://ton.org/docs/learn/overviews/Cells) Ð¸ [BoC](/Cells-BoC.md#bag-of-cells).

To execute the smart contract method, we need to send a request using the TL schema:
`liteServer.runSmcMethod mode:# id:tonNode.blockIdExt account:liteServer.accountId method_id:long params:bytes = liteServer.RunMethodResult`

And wait for a response like:
`liteServer.runMethodResult mode:# id:tonNode.blockIdExt shardblk:tonNode.blockIdExt shard_proof:mode.0?bytes proof:mode.0?bytes state_proof:mode.1?bytes init_c7:mode.3?bytes lib_extras:mode.4?bytes exit_code:int result:mode.2?bytes = liteServer.RunMethodResult;`

In the request, we see the following fields:
1. mode:# - uint32 bitmask of what we want to see in the response, for example, result:mode.2?bytes will only be present in the response if the bit with index 2 is one.
2. id:tonNode.blockIdExt - is our master block state that we got in the previous chapter.
3. account:[liteServer.accountId](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L27) - workchain and smart contract address data.
4. method_id:long - 8 bytes, in which crc16 is written with the XMODEM table on behalf of the called method + bit 17 is set [[Calculation]](https://github.com/xssnick/tonutils-go/blob/88f83bc3554ca78453dd1a42e9e9ea82554e3dd2/ton/runmethod.go#L16)
5. params:bytes - [Stack](https://github.com/ton-blockchain/ton/blob/master/crypto/block/block.tlb#L783) serialized in [BoC](/Cells-BoC.md#bag-of-cells), containing arguments to call the method. [[Implementation example]](https://github.com/xssnick/tonutils-go/blob/88f83bc3554ca78453dd1a42e9e9ea82554e3dd2/tlb/stack.go)

For example, we only need `result:mode.2?bytes`, then our mode will be equal to 0b100, that is 4. In response, we will get:
1. mode:# -> what was sent - 4.
2. id:tonNode.blockIdExt -> our master block against which the method was executed
3. shardblk:tonNode.blockIdExt -> shard block where the contract account is located
4. exit_code:int -> 4 bytes which is the exit code when executing the method. If everything is successful, then = 0, if not, it is equal to the exception code.
5. result:mode.2?bytes -> [Stack](https://github.com/ton-blockchain/ton/blob/master/crypto/block/block.tlb#L783) serialized in [BoC](/Cells-BoC.md#bag-of-cells), containing the values returned by the method.

Let's analyze the call and getting the result from the `a2` method of the contract `EQBL2_3lMiyywU17g-or8N7v9hDmPCpttzBPE2isF2GTzpK4`:

Method code in FunC:
```
(cell, cell) a2() method_id {
  cell a = begin_cell().store_uint(0xAABBCC8, 32).end_cell();
  cell b = begin_cell().store_uint(0xCCFFCC1, 32).end_cell();
  return (a, b);
}
```

Fill out our request:
* `mode` = 4, we only need the result -> `04000000`
* `id` = result of execution getMasterchainInfo
* `account` = workchain 0 (4 bytes `00000000`), and int256 [obtained from our contract address](/Address.md#ÑÐµÑÐ¸Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ñ), i.e. 32 bytes `4bdbfde5322cb2c14d7b83ea2bf0deeff610e63c2a6db7304f1368ac176193ce`
* `method_id` = [computed](https://github.com/xssnick/tonutils-go/blob/88f83bc3554ca78453dd1a42e9e9ea82554e3dd2/ton/runmethod.go#L16) id from `a2` -> `0a2e010000000000`
* `params:bytes` = Our method does not accept input parameters, so we need to pass it an empty stack (`000000`, cell 3 bytes - stack depth 0) serialized in [BoC](/Cells-BoC.md#bag-of-cells) -> `b5ee9c72010101010005000006000000` -> serialize in bytes and get `10b5ee9c72410101010005000006000000000000` 0x10 - size, 3 bytes in the end - padding.

In response we get:
* `mode:#` -> Ð½Ðµ Ð¸Ð½ÑÐµÑÐµÑÐµÐ½
* `id:tonNode.blockIdExt` -> Ð½Ðµ Ð¸Ð½ÑÐµÑÐµÑÐµÐ½
* `shardblk:tonNode.blockIdExt` -> Ð½Ðµ Ð¸Ð½ÑÐµÑÐµÑÐµÐ½
* `exit_code:int` -> ÑÐ°Ð²ÐµÐ½ 0, ÐµÑÐ»Ð¸ Ð²ÑÐµ ÑÑÐ¿ÐµÑÐ½Ð¾
* `result:mode.2?bytes` -> [Stack](https://github.com/ton-blockchain/ton/blob/master/crypto/block/block.tlb#L783) ÑÐ¾Ð´ÐµÑÐ¶Ð°ÑÐ¸Ð¹ Ð²Ð¾Ð·Ð²ÑÐ°ÑÐµÐ½Ð½ÑÐµ Ð¼ÐµÑÐ¾Ð´Ð¾Ð¼ Ð´Ð°Ð½Ð½ÑÐµ Ð² ÑÐ¾ÑÐ¼Ð°ÑÐµ BoC, ÐµÐ³Ð¾ Ð¼Ñ ÑÐ°ÑÐ¿Ð°ÐºÑÐµÐ¼.

ÐÐ½ÑÑÑÐ¸ `result` Ð¼Ñ Ð¿Ð¾Ð»ÑÑÐ¸Ð»Ð¸ `b5ee9c7201010501001b000208000002030102020203030400080ccffcc1000000080aabbcc8`, ÑÑÐ¾ [BoC](/Cells-BoC.md#bag-of-cells) ÑÐ¾Ð´ÐµÑÐ¶Ð°ÑÐ¸Ð¹ ÑÑÐµÐº Ñ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸. ÐÐ¾Ð³Ð´Ð° Ð¼Ñ Ð´ÐµÑÐµÑÐ¸Ð°Ð»Ð¸Ð·ÑÐµÐ¼ ÐµÐ³Ð¾, Ð¼Ñ Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ ÑÑÐµÐ¹ÐºÑ:
```
32[00000203] -> {
  8[03] -> {
    0[],
    32[0AABBCC8]
  },
  32[0CCFFCC1]
}
```
ÐÑÐ»Ð¸ Ð¼Ñ ÐµÐµ ÑÐ°ÑÐ¿Ð°ÑÑÐ¸Ð¼, ÑÐ¾ Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ 2 Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ ÑÐ¸Ð¿Ð° cell, ÐºÐ¾ÑÐ¾ÑÑÐµ Ð²Ð¾Ð·Ð²ÑÐ°ÑÐ°ÐµÑ Ð½Ð°Ñ FunC Ð¼ÐµÑÐ¾Ð´. 
ÐÐµÑÐ²ÑÐµ 3 Ð±Ð°Ð¹ÑÐ° ÐºÐ¾ÑÐ½ÐµÐ²Ð¾Ð¹ ÑÑÐµÐ¹ÐºÐ¸ `000002` - ÑÑÐ¾ Ð³Ð»ÑÐ±Ð¸Ð½Ð° ÑÑÐµÐºÐ°, ÑÐ¾ ÐµÑÑÑ 2. ÐÐ½Ð°ÑÐ¸Ñ Ð¼ÐµÑÐ¾Ð´ Ð²ÐµÑÐ½ÑÐ» Ð½Ð°Ð¼ 2 Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ. 

ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ Ð¿Ð°ÑÑÐ¸Ð½Ð³, ÑÐ»ÐµÐ´ÑÑÑÐ¸Ðµ 8 Ð±Ð¸Ñ (1 Ð±Ð°Ð¹Ñ) - ÑÑÐ¾ ÑÐ¸Ð¿ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ Ð½Ð° ÑÐµÐºÑÑÐµÐ¼ ÑÑÐ¾Ð²Ð½Ðµ ÑÑÐµÐºÐ°. ÐÐ»Ñ Ð½ÐµÐºÐ¾ÑÐ¾ÑÑÑ ÑÐ¸Ð¿Ð¾Ð² Ð¾Ð½ Ð¼Ð¾Ð¶ÐµÑ Ð·Ð°Ð½Ð¸Ð¼Ð°ÑÑ 2 Ð±Ð°Ð¹ÑÐ°. ÐÐ¾Ð·Ð¼Ð¾Ð¶Ð½ÑÐµ Ð²Ð°ÑÐ¸Ð°Ð½ÑÑ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ÑÐ¼Ð¾ÑÑÐµÑÑ Ð² [ÑÑÐµÐ¼Ðµ](https://github.com/ton-blockchain/ton/blob/master/crypto/block/block.tlb#L766). Ð Ð½Ð°ÑÐµÐ¼ ÑÐ»ÑÑÐ°Ðµ Ð¼Ñ Ð¸Ð¼ÐµÐµÐ¼ `03`, ÑÑÐ¾ Ð¾Ð·Ð½Ð°ÑÐ°ÐµÑ:
```
vm_stk_cell#03 cell:^Cell = VmStackValue;
```
ÐÐ½Ð°ÑÐ¸Ñ ÑÐ¸Ð¿ Ð½Ð°ÑÐµÐ³Ð¾ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ - cell, Ð¸, ÑÑÐ´Ñ Ð¿Ð¾ ÑÑÐµÐ¼Ðµ, Ð¾Ð½ ÑÑÐ°Ð½Ð¸Ñ ÑÐ°Ð¼Ð¾ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ðµ, ÐºÐ°Ðº ÑÑÑÐ»ÐºÑ. ÐÐ¾, ÐµÑÐ»Ð¸ Ð¼Ñ Ð¿Ð¾ÑÐ¼Ð¾ÑÑÐ¸Ð¼ Ð½Ð° ÑÑÐµÐ¼Ñ ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ ÑÐ»ÐµÐ¼ÐµÐ½ÑÐ¾Ð² ÑÑÐµÐºÐ°, -
```
vm_stk_cons#_ {n:#} rest:^(VmStackList n) tos:VmStackValue = VmStackList (n + 1);
```
Ð¢Ð¾ ÑÐ²Ð¸Ð´Ð¸Ð¼, ÑÑÐ¾ Ð¿ÐµÑÐ²Ð°Ñ ÑÑÑÐ»ÐºÐ° `rest:^(VmStackList n)` - ÑÑÐ¾ ÑÑÐµÐ¹ÐºÐ° ÑÐ»ÐµÐ´ÑÑÑÐµÐ³Ð¾ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ Ð½Ð° ÑÑÐµÐºÐµ, Ð° Ð½Ð°ÑÐµ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ðµ `tos:VmStackValue` Ð¸Ð´ÐµÑ Ð²ÑÐ¾ÑÑÐ¼, Ð·Ð½Ð°ÑÐ¸Ñ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ñ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ Ð½Ð°Ð¼ Ð½ÑÐ¶Ð½Ð¾ ÑÐ¸ÑÐ°ÑÑ Ð²ÑÐ¾ÑÑÑ ÑÑÑÐ»ÐºÑ, ÑÐ¾ ÐµÑÑÑ `32[0CCFFCC1]` - ÑÑÐ¾ Ð½Ð°Ñ Ð¿ÐµÑÐ²ÑÐ¹ cell, ÐºÐ¾ÑÐ¾ÑÑÐ¹ Ð²ÐµÑÐ½ÑÐ» ÐºÐ¾Ð½ÑÑÐ°ÐºÑ.

Ð¢ÐµÐ¿ÐµÑÑ Ð¼Ñ Ð¼Ð¾Ð¶ÐµÐ¼ Ð·Ð°Ð»ÐµÐ·ÑÑ Ð³Ð»ÑÐ±Ð¶Ðµ Ð¸ Ð´Ð¾ÑÑÐ°ÑÑ Ð²ÑÐ¾ÑÐ¾Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ ÑÑÐµÐºÐ°, Ð¿ÑÐ¾ÑÐ¾Ð´Ð¸Ð¼ Ð¿Ð¾ Ð¿ÐµÑÐ²Ð¾Ð¹ ÑÑÑÐ»ÐºÐµ, ÑÐµÐ¿ÐµÑÑ Ð¼Ñ Ð¸Ð¼ÐµÐµÐ¼:
```
8[03] -> {
    0[],
    32[0AABBCC8]
  }
```
ÐÐ¾Ð²ÑÐ¾ÑÑÐµÐ¼ ÑÐ¾Ñ Ð¶Ðµ Ð¿ÑÐ¾ÑÐµÑÑ. ÐÐµÑÐ²ÑÐµ 8 Ð±Ð¸Ñ = `03` - ÑÐ¾ ÐµÑÑÑ Ð¾Ð¿ÑÑÑ cell. ÐÑÐ¾ÑÐ°Ñ ÑÑÑÐ»ÐºÐ° - ÑÑÐ¾ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ðµ `32[0AABBCC8]` Ð¸, ÑÐ°Ðº ÐºÐ°Ðº Ð³Ð»ÑÐ±Ð¸Ð½Ð° Ð½Ð°ÑÐµÐ³Ð¾ ÑÑÐµÐºÐ° ÑÐ°Ð²Ð½Ð° 2, Ð¼Ñ Ð·Ð°Ð²ÐµÑÑÐ°ÐµÐ¼ Ð¿ÑÐ¾ÑÐ¾Ð´. ÐÑÐ¾Ð³Ð¾, Ð¼Ñ Ð¸Ð¼ÐµÐµÐ¼ 2 Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ, Ð²Ð¾Ð·Ð²ÑÐ°ÑÐµÐ½Ð½ÑÐµ ÐºÐ¾Ð½ÑÑÐ°ÐºÑÐ¾Ð¼, - `32[0CCFFCC1]` Ð¸ `32[0AABBCC8]`. 

ÐÐ±ÑÐ°ÑÐ¸ÑÐµ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ, ÑÑÐ¾ Ð¾Ð½Ð¸ Ð¸Ð´ÑÑ Ð² Ð¾Ð±ÑÐ°ÑÐ½Ð¾Ð¼ Ð¿Ð¾ÑÑÐ´ÐºÐµ. Ð¢Ð¾ÑÐ½Ð¾ ÑÐ°Ðº Ð¶Ðµ Ð½ÑÐ¶Ð½Ð¾ Ð¿ÐµÑÐµÐ´Ð°Ð²Ð°ÑÑ Ð¸ Ð°ÑÐ³ÑÐ¼ÐµÐ½ÑÑ Ð¿ÑÐ¸ Ð²ÑÐ·Ð¾Ð²Ðµ ÑÑÐ½ÐºÑÐ¸Ð¸ - Ð² Ð¾Ð±ÑÐ°ÑÐ½Ð¾Ð¼ Ð¿Ð¾ÑÑÐ´ÐºÐµ Ð¾Ñ ÑÐ¾Ð³Ð¾, ÑÑÐ¾ Ð¼Ñ Ð²Ð¸Ð´Ð¸Ð¼ Ð² ÐºÐ¾Ð´Ðµ FunC. 

[ÐÑÐ¸Ð¼ÐµÑ ÑÐµÐ°Ð»Ð¸Ð·Ð°ÑÐ¸Ð¸](https://github.com/xssnick/tonutils-go/blob/master/ton/runmethod.go#L24)

##### getAccountState
ÐÐ»Ñ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½ÑÑ Ð¾ ÑÐ¾ÑÑÐ¾ÑÐ½Ð¸Ð¸ Ð°ÐºÐºÐ°ÑÐ½ÑÐ°, ÑÐ°ÐºÐ¸Ñ ÐºÐ°Ðº Ð±Ð°Ð»Ð°Ð½Ñ, ÐºÐ¾Ð´ Ð¸ ÑÑÐ°Ð½Ð¸Ð¼ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ Ð¼Ñ, Ð¼Ð¾Ð¶ÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÑ [getAccountState](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L68). ÐÐ»Ñ Ð·Ð°Ð¿ÑÐ¾ÑÐ° Ð½Ð°Ð¼ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸ÑÑÑ [ÑÐ²ÐµÐ¶Ð¸Ð¹ Ð¼Ð°ÑÑÐµÑ Ð±Ð»Ð¾Ðº](#) Ð¸ Ð°Ð´ÑÐµÑ Ð°ÐºÐºÐ°ÑÐ½ÑÐ°. Ð Ð¾ÑÐ²ÐµÑ Ð¼Ñ Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ TL ÑÑÑÑÐºÑÑÑÑ [AccountState](https://github.com/ton-blockchain/ton/blob/master/tl/generate/scheme/lite_api.tl#L38).

Ð Ð°Ð·Ð±ÐµÑÐµÐ¼ AccountState TL ÑÑÐµÐ¼Ñ:
```
liteServer.accountState id:tonNode.blockIdExt shardblk:tonNode.blockIdExt shard_proof:bytes proof:bytes state:bytes = liteServer.AccountState;
```
1. `id` - ÑÑÐ¾ Ð½Ð°Ñ Ð¼Ð°ÑÑÐµÑ Ð±Ð»Ð¾Ðº, Ð¾ÑÐ½Ð¾ÑÐ¸ÑÐµÐ»ÑÐ½Ð¾ ÐºÐ¾ÑÐ¾ÑÐ¾Ð³Ð¾ Ð¼Ñ Ð¿Ð¾Ð»ÑÑÐ¸Ð»Ð¸ Ð´Ð°Ð½Ð½ÑÐµ.
2. `shardblk` - Ð±Ð»Ð¾Ðº ÑÐ°ÑÐ´Ñ Ð²Ð¾ÑÐºÑÐµÐ¸Ð½Ð°, Ð½Ð° ÐºÐ¾ÑÐ¾ÑÐ¾Ð¼ Ð½Ð°ÑÐ¾Ð´Ð¸ÑÑÑ Ð½Ð°Ñ Ð°ÐºÐºÐ°ÑÐ½Ñ, Ð¾ÑÐ½Ð¾ÑÐ¸ÑÐµÐ»ÑÐ½Ð¾ ÐºÐ¾ÑÐ¾ÑÐ¾Ð³Ð¾ Ð¼Ñ Ð¿Ð¾Ð»ÑÑÐ¸Ð»Ð¸ Ð´Ð°Ð½Ð½ÑÐµ.
3. `shard_proof` - merkle Ð¿ÑÑÑ Ð±Ð»Ð¾ÐºÐ° ÑÐ°ÑÐ´Ñ.
4. `proof` - merkle Ð¿ÑÑÑ ÑÐ¾ÑÑÐ¾ÑÐ½Ð¸Ñ Ð°ÐºÐºÐ°ÑÐ½ÑÐ°.
5. `state` - [BoC](/Cells-BoC.md#bag-of-cells) TLB [ÑÑÐµÐ¼Ñ ÑÐ¾ÑÑÐ¾ÑÐ½Ð¸Ñ Ð°ÐºÐºÐ°ÑÐ½ÑÐ°](https://github.com/ton-blockchain/ton/blob/master/crypto/block/block.tlb#L232).

ÐÐ· Ð²ÑÐµÑ ÑÑÐ¸Ñ Ð´Ð°Ð½Ð½ÑÑ ÑÐ¾, ÑÑÐ¾ Ð½Ð°Ð¼ Ð½ÑÐ¶Ð½Ð¾, Ð½Ð°ÑÐ¾Ð´Ð¸ÑÑÑ Ð² `state`, ÑÐ°Ð·Ð±ÐµÑÐµÐ¼ ÐµÐ³Ð¾. 

ÐÐ°Ð¿ÑÐ¸Ð¼ÐµÑ, Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ ÑÐ¾ÑÑÐ¾ÑÐ½Ð¸Ðµ Ð°ÐºÐºÐ°ÑÐ½ÑÐ° TF `EQAhE3sLxHZpsyZ_HecMuwzvXHKLjYx4kEUehhOy2JmCcHCT`, `state` Ð² Ð¾ÑÐ²ÐµÑÐµ Ð±ÑÐ´ÐµÑ:
```
b5ee9c720102350100051e000277c0021137b0bc47669b3267f1de70cbb0cef5c728b8d8c7890451e8613b2d899827026a886043179d3f6000006e233be8722201d7d239dba7d818134001020114ff00f4a413f4bcf2c80b0d021d0000000105036248628d00000000e003040201cb05060013a03128bb16000000002002012007080043d218d748bc4d4f4ff93481fd41c39945d5587b8e2aa2d8a35eaf99eee92d9ba96004020120090a0201200b0c00432c915453c736b7692b5b4c76f3a90e6aeec7a02de9876c8a5eee589c104723a18020004307776cd691fbe13e891ed6dbd15461c098b1b95c822af605be8dc331e7d45571002000433817dc8de305734b0c8a3ad05264e9765a04a39dbe03dd9973aa612a61f766d7c02000431f8c67147ceba1700d3503e54c0820f965f4f82e5210e9a3224a776c8f3fad1840200201200e0f020148101104daf220c7008e8330db3ce08308d71820f90101d307db3c22c00013a1537178f40e6fa1f29fdb3c541abaf910f2a006f40420f90101d31f5118baf2aad33f705301f00a01c20801830abcb1f26853158040f40e6fa120980ea420c20af2670edff823aa1f5340b9f2615423a3534e2a2d2b2c0202cc12130201201819020120141502016616170003d1840223f2980bc7a0737d0986d9e52ed9e013c7a21c2b2f002d00a908b5d244a824c8b5d2a5c0b5007404fc02ba1b04a0004f085ba44c78081ba44c3800740835d2b0c026b500bc02f21633c5b332781c75c8f20073c5bd0032600201201a1b02012020210115bbed96d5034705520db3c8340201481c1d0201201e1f0173b11d7420c235c6083e404074c1e08075313b50f614c81e3d039be87ca7f5c2ffd78c7e443ca82b807d01085ba4d6dc4cb83e405636cf0069006031003daeda80e800e800fa02017a0211fc8080fc80dd794ff805e47a0000e78b64c00015ae19574100d56676a1ec40020120222302014824250151b7255b678626466a4610081e81cdf431c24d845a4000331a61e62e005ae0261c0b6fee1c0b77746e102d0185b5599b6786abe06fedb1c68a2270081e8f8df4a411c4605a400031c34410021ae424bae064f613990039e2ca840090081e886052261c52261c52265c4036625ccd88302d02012026270203993828290111ac1a6d9e2f81b609402d0015adf94100cc9576a1ec1840010da936cf0557c1602d0015addc2ce0806ab33b50f6200220db3c02f265f8005043714313db3ced542d34000ad3ffd3073004a0db3c2fae5320b0f26212b102a425b3531cb9b0258100e1aa23a028bcb0f269820186a0f8010597021110023e3e308e8d11101fdb3c40d778f44310bd05e254165b5473e7561053dcdb3c54710a547abc2e2f32300020ed44d0d31fd307d307d33ff404f404d10048018e1a30d20001f2a3d307d3075003d70120f90105f90115baf2a45003e06c2170542013000c01c8cbffcb0704d6db3ced54f80f70256e5389beb198106e102d50c75f078f1b30542403504ddb3c5055a046501049103a4b0953b9db3c5054167fe2f800078325a18e2c268040f4966fa52094305303b9de208e1638393908d2000197d3073016f007059130e27f080705926c31e2b3e63006343132330060708e2903d08308d718d307f40430531678f40e6fa1f2a5d70bff544544f910f2a6ae5220b15203bd14a1236ee66c2232007e5230be8e205f03f8009322d74a9802d307d402fb0002e83270c8ca0040148040f44302f0078e1771c8cb0014cb0712cb0758cf0158cf1640138040f44301e201208e8a104510344300db3ced54925f06e234001cc8cb1fcb07cb07cb3ff400f400c9
```

[Ð Ð°ÑÐ¿Ð°ÑÑÐ¸Ð¼ ÑÑÐ¾Ñ BoC](/Cells-BoC.md#bag-of-cells) Ð¸ Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ 

<details>
  <summary>Ð±Ð¾Ð»ÑÑÑÑ ÑÑÐµÐ¹ÐºÑ</summary>
  
  ```
  473[C0021137B0BC47669B3267F1DE70CBB0CEF5C728B8D8C7890451E8613B2D899827026A886043179D3F6000006E233BE8722201D7D239DBA7D818130_] -> {
    80[FF00F4A413F4BCF2C80B] -> {
      2[0_] -> {
        4[4_] -> {
          8[CC] -> {
            2[0_] -> {
              13[D180],
              141[F2980BC7A0737D0986D9E52ED9E013C7A218] -> {
                40[D3FFD30730],
                48[01C8CBFFCB07]
              }
            },
            6[64] -> {
              178[00A908B5D244A824C8B5D2A5C0B5007404FC02BA1B048_],
              314[085BA44C78081BA44C3800740835D2B0C026B500BC02F21633C5B332781C75C8F20073C5BD00324_]
            }
          },
          2[0_] -> {
            2[0_] -> {
              84[BBED96D5034705520DB3C_] -> {
                112[C8CB1FCB07CB07CB3FF400F400C9]
              },
              4[4_] -> {
                2[0_] -> {
                  241[AEDA80E800E800FA02017A0211FC8080FC80DD794FF805E47A0000E78B648_],
                  81[AE19574100D56676A1EC0_]
                },
                458[B11D7420C235C6083E404074C1E08075313B50F614C81E3D039BE87CA7F5C2FFD78C7E443CA82B807D01085BA4D6DC4CB83E405636CF0069004_] -> {
                  384[708E2903D08308D718D307F40430531678F40E6FA1F2A5D70BFF544544F910F2A6AE5220B15203BD14A1236EE66C2232]
                }
              }
            },
            2[0_] -> {
              2[0_] -> {
                323[B7255B678626466A4610081E81CDF431C24D845A4000331A61E62E005AE0261C0B6FEE1C0B77746E0_] -> {
                  128[ED44D0D31FD307D307D33FF404F404D1]
                },
                531[B5599B6786ABE06FEDB1C68A2270081E8F8DF4A411C4605A400031C34410021AE424BAE064F613990039E2CA840090081E886052261C52261C52265C4036625CCD882_] -> {
                  128[ED44D0D31FD307D307D33FF404F404D1]
                }
              },
              4[4_] -> {
                2[0_] -> {
                  65[AC1A6D9E2F81B6090_] -> {
                    128[ED44D0D31FD307D307D33FF404F404D1]
                  },
                  81[ADF94100CC9576A1EC180_]
                },
                12[993_] -> {
                  50[A936CF0557C14_] -> {
                    128[ED44D0D31FD307D307D33FF404F404D1]
                  },
                  82[ADDC2CE0806AB33B50F60_]
                }
              }
            }
          }
        },
        872[F220C7008E8330DB3CE08308D71820F90101D307DB3C22C00013A1537178F40E6FA1F29FDB3C541ABAF910F2A006F40420F90101D31F5118BAF2AAD33F705301F00A01C20801830ABCB1F26853158040F40E6FA120980EA420C20AF2670EDFF823AA1F5340B9F2615423A3534E] -> {
          128[DB3C02F265F8005043714313DB3CED54] -> {
            128[ED44D0D31FD307D307D33FF404F404D1],
            112[C8CB1FCB07CB07CB3FF400F400C9]
          },
          128[ED44D0D31FD307D307D33FF404F404D1],
          40[D3FFD30730],
          640[DB3C2FAE5320B0F26212B102A425B3531CB9B0258100E1AA23A028BCB0F269820186A0F8010597021110023E3E308E8D11101FDB3C40D778F44310BD05E254165B5473E7561053DCDB3C54710A547ABC] -> {
            288[018E1A30D20001F2A3D307D3075003D70120F90105F90115BAF2A45003E06C2170542013],
            48[01C8CBFFCB07],
            504[5230BE8E205F03F8009322D74A9802D307D402FB0002E83270C8CA0040148040F44302F0078E1771C8CB0014CB0712CB0758CF0158CF1640138040F44301E2],
            856[DB3CED54F80F70256E5389BEB198106E102D50C75F078F1B30542403504DDB3C5055A046501049103A4B0953B9DB3C5054167FE2F800078325A18E2C268040F4966FA52094305303B9DE208E1638393908D2000197D3073016F007059130E27F080705926C31E2B3E63006] -> {
              112[C8CB1FCB07CB07CB3FF400F400C9],
              384[708E2903D08308D718D307F40430531678F40E6FA1F2A5D70BFF544544F910F2A6AE5220B15203BD14A1236EE66C2232],
              504[5230BE8E205F03F8009322D74A9802D307D402FB0002E83270C8CA0040148040F44302F0078E1771C8CB0014CB0712CB0758CF0158CF1640138040F44301E2],
              128[8E8A104510344300DB3CED54925F06E2] -> {
                112[C8CB1FCB07CB07CB3FF400F400C9]
              }
            }
          }
        }
      }
    },
    114[0000000105036248628D00000000C_] -> {
      7[CA] -> {
        2[0_] -> {
          2[0_] -> {
            266[2C915453C736B7692B5B4C76F3A90E6AEEC7A02DE9876C8A5EEE589C104723A1800_],
            266[07776CD691FBE13E891ED6DBD15461C098B1B95C822AF605BE8DC331E7D45571000_]
          },
          2[0_] -> {
            266[3817DC8DE305734B0C8A3AD05264E9765A04A39DBE03DD9973AA612A61F766D7C00_],
            266[1F8C67147CEBA1700D3503E54C0820F965F4F82E5210E9A3224A776C8F3FAD18400_]
          }
        },
        269[D218D748BC4D4F4FF93481FD41C39945D5587B8E2AA2D8A35EAF99EEE92D9BA96000]
      },
      74[A03128BB16000000000_]
    }
  }
  ```

</details>

Ð¢ÐµÐ¿ÐµÑÑ Ð½Ð°Ð¼ Ð½ÑÐ¶Ð½Ð¾ ÑÐ°ÑÐ¿Ð°ÑÑÐ¸ÑÑ ÑÑÐµÐ¹ÐºÑ Ð² ÑÐ¾Ð¾ÑÐ²ÐµÑÑÑÐ²Ð¸Ð¸ Ñ TL-B ÑÑÑÑÐºÑÑÑÐ¾Ð¹:
```
account_none$0 = Account;

account$1 addr:MsgAddressInt storage_stat:StorageInfo
          storage:AccountStorage = Account;
```
ÐÐ°ÑÐ° ÑÑÑÑÐºÑÑÑÐ° ÑÑÑÐ»Ð°ÐµÑÑÑ Ð½Ð° Ð´ÑÑÐ³Ð¸Ðµ, ÑÐ°ÐºÐ¸Ðµ ÐºÐ°Ðº:
```
anycast_info$_ depth:(#<= 30) { depth >= 1 } rewrite_pfx:(bits depth) = Anycast;
addr_std$10 anycast:(Maybe Anycast) workchain_id:int8 address:bits256  = MsgAddressInt;
addr_var$11 anycast:(Maybe Anycast) addr_len:(## 9) workchain_id:int32 address:(bits addr_len) = MsgAddressInt;
   
storage_info$_ used:StorageUsed last_paid:uint32 due_payment:(Maybe Grams) = StorageInfo;
storage_used$_ cells:(VarUInteger 7) bits:(VarUInteger 7) public_cells:(VarUInteger 7) = StorageUsed;
  
account_storage$_ last_trans_lt:uint64 balance:CurrencyCollection state:AccountState = AccountStorage;

currencies$_ grams:Grams other:ExtraCurrencyCollection = CurrencyCollection;
           
var_uint$_ {n:#} len:(#< n) value:(uint (len * 8)) = VarUInteger n;
var_int$_ {n:#} len:(#< n) value:(int (len * 8)) = VarInteger n;
nanograms$_ amount:(VarUInteger 16) = Grams;  
           
account_uninit$00 = AccountState;
account_active$1 _:StateInit = AccountState;
account_frozen$01 state_hash:bits256 = AccountState;
```

ÐÐ°Ðº Ð¼Ñ Ð²Ð¸Ð´Ð¸Ð¼, ÑÑÐµÐ¹ÐºÐ° ÑÐ¾Ð´ÐµÑÐ¶Ð¸Ñ Ð¾ÑÐµÐ½Ñ Ð¼Ð½Ð¾Ð³Ð¾ Ð´Ð°Ð½Ð½ÑÑ, Ð½Ð¾ Ð¼Ñ ÑÐ°Ð·Ð±ÐµÑÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½ÑÐµ ÐºÐµÐ¹ÑÑ Ð¸ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ðµ Ð±Ð°Ð»Ð°Ð½ÑÐ°, Ð¾ÑÑÐ°Ð»ÑÐ½Ð¾Ðµ Ð²Ñ ÑÐ¼Ð¾Ð¶ÐµÑÐµ ÑÐ°Ð·ÑÐ±ÑÐ°ÑÑ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸ÑÐ½ÑÐ¼ ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð¼.

ÐÐ°ÑÐ½ÐµÐ¼ Ð¿Ð°ÑÑÐ¸Ð½Ð³. Ð Ð´Ð°Ð½Ð½ÑÑ ÐºÐ¾ÑÐ½ÐµÐ²Ð¾Ð¹ ÑÑÐµÐ¹ÐºÐ¸ Ð¼Ñ Ð¸Ð¼ÐµÐµÐ¼:
```
C0021137B0BC47669B3267F1DE70CBB0CEF5C728B8D8C7890451E8613B2D899827026A886043179D3F6000006E233BE8722201D7D239DBA7D818130_
```
ÐÐµÑÐµÐ²ÐµÐ´ÐµÐ¼ Ð² Ð±Ð¸Ð½Ð°ÑÐ½ÑÐ¹ Ð²Ð¸Ð´ Ð¸ Ð¿Ð¾Ð»ÑÑÐ¸Ð¼:
```
11000000000000100001000100110111101100001011110001000111011001101001101100110010011001111111000111011110011100001100101110110000110011101111010111000111001010001011100011011000110001111000100100000100010100011110100001100001001110110010110110001001100110000010011100000010011010101000100001100000010000110001011110011101001111110110000000000000000000000110111000100011001110111110100001110010001000100000000111010111110100100011100111011011101001111101100000011000000100110
```
ÐÐ¾ÑÐ¼Ð¾ÑÑÐ¸Ð¼ Ð½Ð° Ð½Ð°ÑÑ Ð¾ÑÐ½Ð¾Ð²Ð½ÑÑ TL-B ÑÑÑÑÐºÑÑÑÑ, Ð¼Ñ Ð²Ð¸Ð´Ð¸Ð¼, ÑÑÐ¾ Ñ Ð½Ð°Ñ ÐµÑÑÑ 2 Ð²Ð°ÑÐ¸Ð°Ð½ÑÐ° ÑÐ¾Ð³Ð¾, ÑÑÐ¾ ÑÐ°Ð¼ Ð¼Ð¾Ð¶ÐµÑ Ð±ÑÑÑ - `account_none$0` Ð¸Ð»Ð¸ `account$1`. ÐÐ¾Ð½ÑÑÑ, ÐºÐ°ÐºÐ¾Ð¹ Ð²Ð°ÑÐ¸Ð°Ð½Ñ Ñ Ð½Ð°Ñ, Ð¼Ñ Ð¼Ð¾Ð¶ÐµÐ¼ Ð¿ÑÐ¾ÑÐ¸ÑÐ°Ð² Ð¿ÑÐµÑÐ¸ÐºÑ, Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð½ÑÐ¹ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð° $, Ð² Ð½Ð°ÑÐµÐ¼ ÑÐ»ÑÑÐ°Ðµ ÑÑÐ¾ 1 Ð±Ð¸Ñ. ÐÑÐ»Ð¸ ÑÐ°Ð¼ 0, ÑÐ¾ Ñ Ð½Ð°Ñ `account_none`, ÐµÑÐ»Ð¸ 1, ÑÐ¾ `account`. 

ÐÐ°Ñ Ð¿ÐµÑÐ²ÑÐ¹ Ð±Ð¸Ñ Ð¸Ð· Ð´Ð°Ð½Ð½ÑÑ Ð²ÑÑÐµ = 1, Ð·Ð½Ð°ÑÐ¸Ñ Ð¼Ñ ÑÐ°Ð±Ð¾ÑÐ°ÐµÐ¼ Ñ `account$1` Ð¸ Ð±ÑÐ´ÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÑ ÑÑÐµÐ¼Ñ:
```
account$1 addr:MsgAddressInt storage_stat:StorageInfo
          storage:AccountStorage = Account;
```
ÐÐ°Ð»ÐµÐµ Ñ Ð½Ð°Ñ Ð¸Ð´ÐµÑ `addr:MsgAddressInt`, Ð¼Ñ Ð²Ð¸Ð´Ð¸Ð¼, ÑÑÐ¾ Ð´Ð»Ñ MsgAddressInt Ñ Ð½Ð°Ñ ÑÐ¾Ð¶Ðµ ÐµÑÑÑ Ð½ÐµÑÐºÐ¾Ð»ÑÐºÐ¾ Ð²Ð°ÑÐ¸Ð°Ð½ÑÐ¾Ð²:
```
addr_std$10 anycast:(Maybe Anycast) workchain_id:int8 address:bits256  = MsgAddressInt;
addr_var$11 anycast:(Maybe Anycast) addr_len:(## 9) workchain_id:int32 address:(bits addr_len) = MsgAddressInt;
```
Ð§ÑÐ¾Ð±Ñ Ð¿Ð¾Ð½ÑÑÑ Ñ ÐºÐ°ÐºÐ¸Ð¼ Ð¸Ð¼ÐµÐ½Ð½Ð¾ ÑÐ°Ð±Ð¾ÑÐ°ÑÑ, Ð¼Ñ, ÐºÐ°Ðº Ð¸ Ð² Ð¿ÑÐ¾ÑÐ»ÑÐ¹ ÑÐ°Ð·, ÑÐ¸ÑÐ°ÐµÐ¼ Ð±Ð¸ÑÑ Ð¿ÑÐµÑÐ¸ÐºÑÐ°, Ð² ÑÑÐ¾Ñ ÑÐ°Ð· Ð¼Ñ ÑÐ¸ÑÐ°ÐµÐ¼ 2 Ð±Ð¸ÑÐ°. ÐÑÑÐµÐ·Ð°ÐµÐ¼ ÑÐ¶Ðµ Ð¿ÑÐ¾ÑÐ¸ÑÐ°Ð½Ð½ÑÐ¹ Ð±Ð¸Ñ, Ð¾ÑÑÐ°ÐµÑÑÑ `1000000...`, ÑÐ¸ÑÐ°ÐµÐ¼ Ð¿ÐµÑÐ²ÑÐµ 2 Ð±Ð¸ÑÐ° Ð¸ Ð¿Ð¾Ð»ÑÑÐ°ÐµÐ¼ `10`, Ð·Ð½Ð°ÑÐ¸Ñ Ð¼Ñ ÑÐ°Ð±Ð¾ÑÐ°ÐµÐ¼ Ñ `addr_std$10`.

Ð¡Ð»ÐµÐ´ÑÑÑÐ¸Ð¼ Ð¼Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ ÑÐ°ÑÐ¿Ð°ÑÑÐ¸ÑÑ `anycast:(Maybe Anycast)`, Maybe Ð·Ð½Ð°ÑÐ¸Ñ, ÑÑÐ¾ Ð¼Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ Ð¿ÑÐ¾ÑÐ¸ÑÐ°ÑÑ 1 Ð±Ð¸Ñ, Ð¸ ÐµÑÐ»Ð¸ ÑÐ°Ð¼ ÐµÐ´Ð¸Ð½Ð¸ÑÐ° - ÑÐ¸ÑÐ°ÑÑ Anycast, Ð¸Ð½Ð°ÑÐµ Ð¿ÑÐ¾Ð¿ÑÑÑÐ¸ÑÑ. ÐÐ°ÑÐ¸ Ð¾ÑÑÐ°Ð²ÑÐ¸ÐµÑÑ Ð±Ð¸ÑÑ - ÑÑÐ¾ `00000...`, ÑÐ¸ÑÐ°ÐµÐ¼ 1 Ð±Ð¸Ñ, ÑÑÐ¾ 0, Ð·Ð½Ð°ÑÐ¸Ñ Ð¿ÑÐ¾Ð¿ÑÑÐºÐ°ÐµÐ¼ Anycast.

ÐÐ°Ð»ÐµÐµ Ñ Ð½Ð°Ñ Ð¸Ð´ÐµÑ `workchain_id:int8`, ÑÑÑ Ð²ÑÐµ Ð¿ÑÐ¾ÑÑÐ¾, ÑÐ¸ÑÐ°ÐµÐ¼ 8 Ð±Ð¸Ñ, ÑÑÐ¾ Ð±ÑÐ´ÐµÑ Ð°Ð¹Ð´Ð¸ Ð²Ð¾ÑÐºÑÐµÐ¸Ð½Ð°. Ð§Ð¸ÑÐ°ÐµÐ¼ ÑÐ»ÐµÐ´ÑÑÑÐ¸Ðµ 8 Ð±Ð¸Ñ, Ð²ÑÐµ Ð½ÑÐ»Ð¸, Ð·Ð½Ð°ÑÐ¸Ñ Ð²Ð¾ÑÐºÑÐµÐ¸Ð½ ÑÐ°Ð²ÐµÐ½ 0.

ÐÐ°Ð»ÐµÐµ ÑÐ¸ÑÐ°ÐµÐ¼ `address:bits256`, ÑÑÐ¾ 256 Ð±Ð¸Ñ Ð°Ð´ÑÐµÑÐ°, Ð¿Ð¾ ÑÐ¾Ð¼Ñ Ð¶Ðµ Ð¿ÑÐ¸Ð½ÑÐ¸Ð¿Ñ, ÑÑÐ¾ Ð¸ Ñ `workchain_id`. ÐÑÐ¾ÑÐ¸ÑÐ°Ð², Ð¼Ñ Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ `21137B0BC47669B3267F1DE70CBB0CEF5C728B8D8C7890451E8613B2D8998270` Ð² hex Ð¿ÑÐµÐ´ÑÑÐ°Ð²Ð»ÐµÐ½Ð¸Ð¸.



ÐÑ Ð¿ÑÐ¾ÑÐ¸ÑÐ°Ð»Ð¸ Ð°Ð´ÑÐµÑ `addr:MsgAddressInt`, Ð´Ð°Ð»ÐµÐµ Ñ Ð½Ð°Ñ Ð¸Ð´ÐµÑ `storage_stat:StorageInfo` Ð¸Ð· Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÑÑÑÑÐºÑÑÑÑ, ÐµÐ³Ð¾ ÑÑÐµÐ¼Ð°:
```
storage_info$_ used:StorageUsed last_paid:uint32 due_payment:(Maybe Grams) = StorageInfo;
```
ÐÐµÑÐ²ÑÐ¼ Ð¸Ð´ÐµÑ `used:StorageUsed`, ÑÐ¾ ÑÑÐµÐ¼Ð¾Ð¹:
```
storage_used$_ cells:(VarUInteger 7) bits:(VarUInteger 7) public_cells:(VarUInteger 7) = StorageUsed;
```
Ð­ÑÐ¾ ÐºÐ¾Ð»Ð¸ÑÐµÑÑÐ²Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·ÑÐµÐ¼ÑÑ ÑÑÐµÐµÐº Ð¸ Ð±Ð¸ÑÐ¾Ð² Ð´Ð»Ñ ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½ÑÑ Ð°ÐºÐºÐ°ÑÐ½ÑÐ°. ÐÐ°Ð¶Ð´Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð¾Ð¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¾, ÐºÐ°Ðº `VarUInteger 7`, ÑÑÐ¾ Ð·Ð½Ð°ÑÐ¸Ñ uint Ð´Ð¸Ð½Ð°Ð¼Ð¸ÑÐµÑÐºÐ¾Ð³Ð¾ ÑÐ°Ð·Ð¼ÐµÑÐ°, Ð½Ð¾ Ð¼Ð°ÐºÑÐ¸Ð¼ÑÐ¼ 7 Ð±Ð¸Ñ. ÐÐ¾Ð½ÑÑÑ, ÐºÐ°Ðº Ð¾Ð½ ÑÑÑÑÐ¾ÐµÐ½, Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ ÑÑÐµÐ¼Ðµ:
```
var_uint$_ {n:#} len:(#< n) value:(uint (len * 8)) = VarUInteger n;
```
Ð Ð½Ð°ÑÐµÐ¼ ÑÐ»ÑÑÐ°Ðµ n Ð±ÑÐ´ÐµÑ ÑÐ°Ð²ÐµÐ½ 7. Ð len Ñ Ð½Ð°Ñ Ð±ÑÐ´ÐµÑ `(#< 7)` ÑÑÐ¾ Ð·Ð½Ð°ÑÐ¸Ñ ÐºÐ¾Ð»Ð¸ÑÐµÑÑÐ²Ð¾ Ð±Ð¸Ñ, ÐºÐ¾ÑÐ¾ÑÐ¾Ðµ Ð²Ð¼ÐµÑÐ°ÐµÑ ÑÐ¸ÑÐ»Ð¾ Ð´Ð¾ 7. ÐÐ¿ÑÐµÐ´ÐµÐ»Ð¸ÑÑ ÐµÐ³Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾, Ð¿ÐµÑÐµÐ²ÐµÐ´Ñ 7-1=6 Ð² Ð±Ð¸Ð½Ð°ÑÐ½ÑÐ¹ Ð²Ð¸Ð´ - `110`, Ð¿Ð¾Ð»ÑÑÐ°ÐµÐ¼ 3 Ð±Ð¸ÑÐ°, Ð·Ð½Ð°ÑÐ¸Ñ Ð´Ð»Ð¸Ð½Ð° len = 3 Ð±Ð¸ÑÐ°. Ð value - ÑÑÐ¾ `(uint (len * 8))`. Ð§ÑÐ¾Ð±Ñ ÐµÐ³Ð¾ Ð¾Ð¿ÑÐµÐ´ÐµÐ»Ð¸ÑÑ, Ð½Ð°Ð¼ Ð½ÑÐ¶Ð½Ð¾ Ð¿ÑÐ¾ÑÐ¸ÑÐ°ÑÑ 3 Ð±Ð¸ÑÐ° Ð´Ð»Ð¸Ð½Ñ, Ð¿Ð¾Ð»ÑÑÐ¸ÑÑ ÑÐ¸ÑÐ»Ð¾ Ð¸ ÑÐ¼Ð½Ð¾Ð¶Ð¸ÑÑ Ð½Ð° 8, ÑÑÐ¾ Ð±ÑÐ´ÐµÑ ÑÐ°Ð·Ð¼ÐµÑ `value`, ÑÐ¾ ÐµÑÑÑ ÐºÐ¾Ð»Ð¸ÑÐµÑÑÐ²Ð¾ Ð±Ð¸ÑÐ¾Ð², ÐºÐ¾ÑÐ¾ÑÐ¾Ðµ Ð½ÑÐ¶Ð½Ð¾ Ð¿ÑÐ¾ÑÐ¸ÑÐ°ÑÑ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ñ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ VarUInteger.

ÐÑÐ¾ÑÐ¸ÑÐ°ÐµÐ¼ `cells:(VarUInteger 7)`, Ð²Ð¾Ð·ÑÐ¼ÐµÐ¼ Ð½Ð°ÑÐ¸ ÑÐ»ÐµÐ´ÑÑÑÐ¸Ðµ Ð±Ð¸ÑÑ Ð¸Ð· ÐºÐ¾ÑÐ½ÐµÐ²Ð¾Ð¹ ÑÑÐµÐ¹ÐºÐ¸, Ð¿Ð¾ÑÐ¼Ð¾ÑÑÐ¸Ð¼ Ð½Ð° ÑÐ»ÐµÐ´ÑÑÑÐ¸Ðµ 16 Ð±Ð¸Ñ Ð´Ð»Ñ Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ, ÑÑÐ¾ `0010011010101000`. Ð§Ð¸ÑÐ°ÐµÐ¼ Ð¿ÐµÑÐ²ÑÐµ 3 Ð±Ð¸ÑÐ° len, ÑÑÐ¾ `001`, ÑÐ¾ ÐµÑÑÑ 1, Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ ÑÐ°Ð·Ð¼ÐµÑ (uint (1 * 8)), Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ uint 8, ÑÐ¸ÑÐ°ÐµÐ¼ 8 Ð±Ð¸Ñ, ÑÑÐ¾ Ð±ÑÐ´ÐµÑ `cells`, `00110101`, ÑÐ¾ ÐµÑÑÑ 53 Ð² Ð´ÐµÑÑÑÐµÑÐ¸ÑÐ½Ð¾Ð¼ Ð²Ð¸Ð´Ðµ. ÐÐµÐ»Ð°ÐµÐ¼ ÑÐ¾ Ð¶Ðµ ÑÐ°Ð¼Ð¾Ðµ Ð´Ð»Ñ `bits` Ð¸ `public_cells`.

ÐÑ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¿ÑÐ¾ÑÐ¸ÑÐ°Ð»Ð¸ `used:StorageUsed`, ÑÐ»ÐµÐ´ÑÑÑÐ¸Ð¼ Ñ Ð½Ð°Ñ Ð¸Ð´ÐµÑ `last_paid:uint32`, ÑÑÑ Ð²ÑÐµ Ð¿ÑÐ¾ÑÑÐ¾, ÑÐ¸ÑÐ°ÐµÐ¼ 32 Ð±Ð¸ÑÐ°. Ð¢Ð°Ðº Ð¶Ðµ Ð²ÑÐµ Ð¿ÑÐ¾ÑÑÐ¾ Ñ `due_payment:(Maybe Grams)` ÑÑÑ Ð¼ÐµÐ¹Ð±Ð¸, ÐºÐ¾ÑÐ¾ÑÑÐ¹ Ð±ÑÐ´ÐµÑ 0, ÑÐ¾Ð¾ÑÐ²ÐµÑÑÑÐ²ÐµÐ½Ð½Ð¾ Grams Ð¼Ñ Ð¿ÑÐ¾Ð¿ÑÑÐºÐ°ÐµÐ¼. ÐÐ¾, ÐµÑÐ»Ð¸ Ð¼ÐµÐ¹Ð±Ð¸ ÑÐ°Ð²ÐµÐ½ 1, Ð¼Ñ Ð¼Ð¾Ð¶ÐµÐ¼ Ð²Ð·Ð³Ð»ÑÐ½ÑÑÑ Ð½Ð° ÑÑÐµÐ¼Ñ Grams `amount:(VarUInteger 16) = Grams` Ð¸ ÑÑÐ°Ð·Ñ Ð¿Ð¾Ð½ÑÑÑ, ÑÑÐ¾ Ð¼Ñ ÑÐ¶Ðµ ÑÐ¼ÐµÐµÐ¼ Ñ ÑÐ°ÐºÐ¸Ð¼ ÑÐ°Ð±Ð¾ÑÐ°ÑÑ. ÐÐ°Ðº Ð² Ð¿ÑÐ¾ÑÐ»ÑÐ¹ ÑÐ°Ð·, ÑÐ¾Ð»ÑÐºÐ¾ Ð²Ð¼ÐµÑÑÐ¾ 7 - Ñ Ð½Ð°Ñ 16.

ÐÐ°Ð»ÐµÐµ Ñ Ð½Ð°Ñ `storage:AccountStorage` ÑÐ¾ ÑÑÐµÐ¼Ð¾Ð¹:
```
account_storage$_ last_trans_lt:uint64 balance:CurrencyCollection state:AccountState = AccountStorage;
```
Ð§Ð¸ÑÐ°ÐµÐ¼ `last_trans_lt:uint64`, ÑÑÐ¾ 64 Ð±Ð¸ÑÐ°, ÑÑÐ°Ð½ÑÑÐ¸Ðµ lt Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ ÑÑÐ°Ð½Ð·Ð°ÐºÑÐ¸Ð¸ Ð°ÐºÐºÐ°ÑÐ½ÑÐ°. Ð, Ð½Ð°ÐºÐ¾Ð½ÐµÑ, Ð±Ð°Ð»Ð°Ð½Ñ, Ð¿ÑÐµÐ´ÑÑÐ°Ð²Ð»ÐµÐ½Ð½ÑÐ¹ ÑÑÐµÐ¼Ð¾Ð¹:
```
currencies$_ grams:Grams other:ExtraCurrencyCollection = CurrencyCollection;
```
ÐÑÑÑÐ´Ð° Ð¼Ñ Ð¿ÑÐ¾ÑÐ¸ÑÐ°ÐµÐ¼ `grams:Grams`, ÐºÐ¾ÑÐ¾ÑÑÐ¹ Ð±ÑÐ´ÐµÑ ÑÐ²Ð»ÑÑÑÑÑ Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð¼ Ð°ÐºÐºÐ°ÑÐ½ÑÐ° Ð² Ð½Ð°Ð½Ð¾-ÑÐ¾Ð½Ð°Ñ.
`grams:Grams` ÑÑÐ¾ `VarUInteger 16`, Ð´Ð»Ñ ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ 16 (Ð² Ð±Ð¸Ð½Ð°ÑÐ½Ð¾Ð¼ Ð²Ð¸Ð´Ðµ `10000`, Ð¾ÑÐ½ÑÐ² 1 Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ `1111`) Ð·Ð½Ð°ÑÐ¸Ñ ÑÐ¸ÑÐ°ÐµÐ¼ Ð¿ÐµÑÐ²ÑÐµ 4 Ð±Ð¸ÑÐ°, Ð¸ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð½Ð¾Ðµ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ðµ ÑÐ¼Ð½Ð¾Ð¶Ð°ÐµÐ¼ Ð½Ð° 8, Ð´Ð°Ð»ÐµÐµ ÑÐ¸ÑÐ°ÐµÐ¼ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸ÑÐµÑÑÐ²Ð¾ Ð±Ð¸Ñ, ÑÑÐ¾ Ð¸ Ð±ÑÐ´ÐµÑ Ð½Ð°ÑÐ¸Ð¼ Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð¼. 

Ð Ð°Ð·Ð±ÐµÑÐµÐ¼ Ð½Ð° Ð½Ð°ÑÐ¸Ñ Ð´Ð°Ð½Ð½ÑÑ Ð½Ð°ÑÐ¸ Ð¾ÑÑÐ°Ð²ÑÐ¸ÐµÑÑ Ð±Ð¸ÑÑ:
```
100000000111010111110100100011100111011011101001111101100000011000000100110
```
Ð§Ð¸ÑÐ°ÐµÐ¼ Ð¿ÐµÑÐ²ÑÐµ 4 Ð±Ð¸ÑÐ° - `1000`, ÑÑÐ¾ 8. 8*8=64, ÑÐ¸ÑÐ°ÐµÐ¼ ÑÐ»ÐµÐ´ÑÑÑÐ¸Ðµ 64 Ð±Ð¸ÑÐ° = `0000011101011111010010001110011101101110100111110110000001100000`, ÑÐ±ÑÐ°Ð² Ð»Ð¸ÑÐ½Ð¸Ðµ Ð½ÑÐ»ÐµÐ²ÑÐµ Ð±Ð¸ÑÑ, Ð¿Ð¾Ð»ÑÑÐ¸Ð¼ `11101011111010010001110011101101110100111110110000001100000`, ÑÑÐ¾ ÑÐ°Ð²Ð½Ð¾ `531223439883591776`, Ð¸, Ð¿ÐµÑÐµÐ²ÐµÐ´Ñ Ð¸Ð· Ð½Ð°Ð½Ð¾ Ð² ÑÐ¾Ð½, Ð¿Ð¾Ð»ÑÑÐ°ÐµÐ¼ `531223439.883591776`.

ÐÐ° ÑÑÐ¾Ð¼ Ð¼Ñ Ð¾ÑÑÐ°Ð½Ð¾Ð²Ð¸Ð¼ÑÑ, ÑÐ°Ðº ÐºÐ°Ðº ÑÐ¶Ðµ ÑÐ°Ð·Ð¾Ð±ÑÐ°Ð»Ð¸ Ð²ÑÐµ Ð¾ÑÐ½Ð¾Ð²Ð½ÑÐµ ÐºÐµÐ¹ÑÑ, Ð¾ÑÑÐ°Ð»ÑÐ½Ð¾Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð»ÑÑÐ¸ÑÑ Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸ÑÐ½ÑÐ¼ Ð¾Ð±ÑÐ°Ð·Ð¾Ð¼ Ñ ÑÐµÐ¼, ÑÑÐ¾ Ð¼Ñ ÑÐ°Ð·Ð±ÑÐ°Ð»Ð¸. Ð¢Ð°Ðº Ð¶Ðµ, Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸ÑÐµÐ»ÑÐ½ÑÑ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ Ð¿Ð¾ ÑÐ°Ð·Ð¾Ð±ÑÑ TL-B Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¹ÑÐ¸ Ð² [Ð¾ÑÑÐ¸ÑÐ¸Ð°Ð»ÑÐ½Ð¾Ð¹ Ð´Ð¾ÐºÑÐ¼ÐµÐ½ÑÐ°ÑÐ¸Ð¸](/TL-B.md)

##### ÐÑÑÐ³Ð¸Ðµ Ð¼ÐµÑÐ¾Ð´Ñ
Ð¢ÐµÐ¿ÐµÑÑ, Ð¸Ð·ÑÑÐ¸Ð² Ð²ÑÑ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ, Ð²Ñ Ð¼Ð¾Ð¶ÐµÑÐµ Ð²ÑÐ·ÑÐ²Ð°ÑÑ Ð¸ Ð¾Ð±ÑÐ°Ð±Ð°ÑÑÐ²Ð°ÑÑ Ð¾ÑÐ²ÐµÑÑ Ð¸ Ð¾Ñ Ð´ÑÑÐ³Ð¸Ñ Ð¼ÐµÑÐ¾Ð´Ð¾Ð² lite-server'Ð°. ÐÑÐ¸Ð½ÑÐ¸Ð¿ ÑÐ¾Ñ Ð¶Ðµ :)

## ÐÐ¾Ð¿Ð¾Ð»Ð½Ð¸ÑÐµÐ»ÑÐ½ÑÐµ ÑÐµÑÐ½Ð¸ÑÐµÑÐºÐ¸Ðµ Ð´ÐµÑÐ°Ð»Ð¸ ÑÐµÐ½Ð´ÑÐµÐ¹ÐºÐ°

#### ÐÐ¾Ð»ÑÑÐµÐ½Ð¸Ðµ Ð°Ð¹Ð´Ð¸ ÐºÐ»ÑÑÐ°
ÐÐ¹Ð´Ð¸ ÐºÐ»ÑÑÐ° - ÑÑÐ¾ SHA256 ÑÑÑ ÑÐµÑÐ¸Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾Ð¹ TL ÑÑÐµÐ¼Ñ.

Ð§Ð°ÑÐµ Ð²ÑÐµÐ³Ð¾ Ð¿ÑÐ¸Ð¼ÐµÐ½ÑÑÑÑÑ ÑÐ»ÐµÐ´ÑÑÑÐ¸Ðµ TL ÑÑÐµÐ¼Ñ:
```
pub.ed25519 key:int256 = PublicKey -- ID c6b41348
pub.aes key:int256 = PublicKey     -- ID d4adbc2d
pub.overlay name:bytes = PublicKey -- ID cb45ba34
pub.unenc data:bytes = PublicKey   -- ID 0a451fb6
pk.aes key:int256 = PrivateKey     -- ID 3751e8a5
```

ÐÐ°Ðº Ð¿ÑÐ¸Ð¼ÐµÑ, Ð´Ð»Ñ ÐºÐ»ÑÑÐµÐ¹ ÑÐ¸Ð¿Ð° ED25519, ÐºÐ¾ÑÐ¾ÑÑÐµ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·ÑÑÑÑÑ Ð´Ð»Ñ ÑÐµÐ½Ð´ÑÐµÐ¹ÐºÐ°, ID ÐºÐ»ÑÑÐ° Ð±ÑÐ´ÐµÑ ÑÐ²Ð»ÑÑÑÑÑ sha256 ÑÐµÑÐ¾Ð¼ Ð¾Ñ 
**[0xC6, 0xB4, 0x13, 0x48]** Ð¸ **Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð³Ð¾ ÐºÐ»ÑÑÐ°**, (Ð¼Ð°ÑÑÐ¸Ð²Ð° Ð±Ð°Ð¹Ñ ÑÐ°Ð·Ð¼ÐµÑÐ¾Ð¼ 36, Ð¿ÑÐµÑÐ¸ÐºÑ + ÐºÐ»ÑÑ)

[ÐÑÐ¸Ð¼ÐµÑ ÐºÐ¾Ð´Ð°](https://github.com/xssnick/tonutils-go/blob/2b5e5a0e6ceaf3f28309b0833cb45de81c580acc/liteclient/crypto.go#L16)

#### Ð¨Ð¸ÑÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÑ Handshake Ð¿Ð°ÐºÐµÑÐ°
Ð¥ÑÐ½Ð´ÑÐµÐ¹Ðº Ð¿Ð°ÐºÐµÑ Ð¾ÑÐ¿ÑÐ°Ð²Ð»ÑÐµÑÑÑ Ð² Ð¿Ð¾Ð»ÑÐ¾ÑÐºÑÑÑÐ¾Ð¼ Ð²Ð¸Ð´Ðµ, Ð·Ð°ÑÐ¸ÑÑÐ¾Ð²Ð°Ð½Ñ ÑÐ¾Ð»ÑÐºÐ¾ 160 Ð±Ð°Ð¹Ñ, ÑÐ¾Ð´ÐµÑÐ¶Ð°ÑÐ¸Ðµ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ Ð¾ Ð¿Ð¾ÑÑÐ¾ÑÐ½Ð½ÑÑ ÑÐ¸ÑÑÐ°Ñ.

Ð§ÑÐ¾Ð±Ñ Ð¸Ñ Ð·Ð°ÑÐ¸ÑÑÐ¾Ð²Ð°ÑÑ, Ð½Ð°Ð¼ Ð½ÑÐ¶ÐµÐ½ AES-CTR ÑÐ¸ÑÑ, Ð´Ð»Ñ ÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ñ Ð½Ð°Ð¼ Ð½ÑÐ¶ÐµÐ½ SHA256 ÑÑÑ Ð¾Ñ 160 Ð±Ð°Ð¹Ñ Ð¸ [Ð¾Ð±ÑÐ¸Ð¹ ÐºÐ»ÑÑ ECDH](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B1%D1%89%D0%B5%D0%B3%D0%BE-%D0%BA%D0%BB%D1%8E%D1%87%D0%B0-%D0%BF%D0%BE-ecdh)

Ð¨Ð¸ÑÑ ÑÐ¾Ð±Ð¸ÑÐ°ÐµÑÑÑ ÑÐ»ÐµÐ´ÑÑÑÐ¸Ð¼ Ð¾Ð±ÑÐ°Ð·Ð¾Ð¼:
* ÐºÐ»ÑÑ = (0 - 15 Ð±Ð°Ð¹ÑÑ Ð¾Ð±ÑÐµÐ³Ð¾ ÐºÐ»ÑÑÐ°) + (16 - 31 Ð±Ð°Ð¹ÑÑ ÑÑÑÐ°)
* iv   = (0 - 3 Ð±Ð°Ð¹ÑÑ ÑÑÑÐ°) + (20 - 31 Ð±Ð°Ð¹ÑÑ Ð¾Ð±ÑÐµÐ³Ð¾ ÐºÐ»ÑÑÐ°)

ÐÐ¾ÑÐ»Ðµ ÑÐ¾Ð³Ð¾, ÐºÐ°Ðº ÑÐ¸ÑÑ ÑÐ¾Ð±ÑÐ°Ð½, Ð¼Ñ ÑÐ¸ÑÑÑÐµÐ¼ Ð¸Ð¼ Ð½Ð°ÑÐ¸ 160 Ð±Ð°Ð¹Ñ.

[ÐÑÐ¸Ð¼ÐµÑ ÐºÐ¾Ð´Ð°](https://github.com/xssnick/tonutils-go/blob/2b5e5a0e6ceaf3f28309b0833cb45de81c580acc/liteclient/connection.go#L361)

#### ÐÐ¾Ð»ÑÑÐµÐ½Ð¸Ðµ Ð¾Ð±ÑÐµÐ³Ð¾ ÐºÐ»ÑÑÐ° Ð¿Ð¾ ECDH
ÐÐ»Ñ ÑÐ°ÑÑÐµÑÐ° Ð¾Ð±ÑÐµÐ³Ð¾ ÐºÐ»ÑÑÐ° Ð½Ð°Ð¼ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸ÑÑÑ Ð½Ð°Ñ Ð¿ÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ ÐºÐ»ÑÑ Ð¸ Ð¿ÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ ÐºÐ»ÑÑ ÑÐµÑÐ²ÐµÑÐ°. 

Ð¡ÑÑÑ DH Ð² Ð¿Ð¾Ð»ÑÑÐµÐ½Ð¸Ð¸ Ð¾Ð±ÑÐµÐ³Ð¾ ÑÐµÐºÑÐµÑÐ½Ð¾Ð³Ð¾ ÐºÐ»ÑÑÐ°, Ð±ÐµÐ· ÑÐ°Ð·Ð³Ð»Ð°ÑÐµÐ½Ð¸Ñ Ð¿ÑÐ¸Ð²Ð°ÑÐ½Ð¾Ð¹ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ð¸. ÐÑÐ¸Ð²ÐµÐ´Ñ Ð¿ÑÐ¸Ð¼ÐµÑ, ÐºÐ°Ðº ÑÑÐ¾ Ð¿ÑÐ¾Ð¸ÑÑÐ¾Ð´Ð¸Ñ, Ð² Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑÐ½Ð¾ ÑÐ¿ÑÐ¾ÑÐµÐ½Ð½Ð¾Ð¼ Ð²Ð¸Ð´Ðµ.
ÐÑÐµÐ´Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð¼, ÑÑÐ¾ Ð½ÑÐ¶Ð½Ð¾ ÑÐ³ÐµÐ½ÐµÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¾Ð±ÑÐ¸Ð¹ ÐºÐ»ÑÑ Ð¼ÐµÐ¶Ð´Ñ Ð½Ð°Ð¼Ð¸ Ð¸ ÑÐµÑÐ²ÐµÑÐ¾Ð¼, Ð¿ÑÐ¾ÑÐµÑÑ Ð±ÑÐ´ÐµÑ Ð²ÑÐ³Ð»ÑÐ´ÐµÑÑ ÑÐ°Ðº:
1. ÐÑ Ð³ÐµÐ½ÐµÑÐ¸ÑÑÐµÐ¼ ÑÐµÐºÑÐµÑÐ½Ð¾Ðµ Ð¸ Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ðµ ÑÐ¸ÑÐ»Ð°, Ð½Ð°Ð¿ÑÐ¸Ð¼ÐµÑ **6** Ð¸ **7**
2. Ð¡ÐµÑÐ²ÐµÑ Ð³ÐµÐ½ÐµÑÐ¸ÑÑÐµÑ ÑÐµÐºÑÐµÑÐ½Ð¾Ðµ Ð¸ Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ðµ ÑÐ¸ÑÐ»Ð°, Ð½Ð°Ð¿ÑÐ¸Ð¼ÐµÑ **5** Ð¸ **15**
3. ÐÑ Ñ ÑÐµÑÐ²ÐµÑÐ¾Ð¼ Ð¾Ð±Ð¼ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ÑÑ Ð¿ÑÐ±Ð»Ð¸ÑÐ½ÑÐ¼Ð¸ ÑÐ¸ÑÐ»Ð°Ð¼Ð¸, Ð¾ÑÐ¿ÑÐ°Ð²Ð»ÑÐµÐ¼ ÑÐµÑÐ²ÐµÑÑ **7**, Ð¾Ð½ Ð½Ð°Ð¼ Ð¾ÑÐ¿ÑÐ°Ð²Ð»ÑÐµÑ **15**.
4. ÐÑ Ð²ÑÑÑÐ¸ÑÑÐ²Ð°ÐµÐ¼: **7^6 mod 15 = 4**
5. Ð¡ÐµÑÐ²ÐµÑ Ð²ÑÑÑÐ¸ÑÑÐ²Ð°ÐµÑ: **7^5 mod 15 = 7**
6. ÐÐ±Ð¼ÐµÐ½Ð¸Ð²Ð°ÐµÐ¼ÑÑ Ð¿Ð¾Ð»ÑÑÐµÐ½Ð½ÑÐ¼Ð¸ ÑÐ¸ÑÐ»Ð°Ð¼Ð¸, Ð¼Ñ ÑÐµÑÐ²ÐµÑÑ **4**, Ð¾Ð½ Ð½Ð°Ð¼ **7**
7. ÐÑ Ð²ÑÑÑÐ¸ÑÑÐ²Ð°ÐµÐ¼ **7^6 mod 15 = 4**
8. Ð¡ÐµÑÐ²ÐµÑ Ð²ÑÑÑÐ¸ÑÑÐ²Ð°ÐµÑ: **4^5 mod 15 = 4**
9. ÐÐ±ÑÐ¸Ð¹ ÐºÐ»ÑÑ = **4**

ÐÐµÑÐ°Ð»Ð¸ ÑÐ°Ð¼Ð¾Ð³Ð¾ ECDH Ð±ÑÐ´ÑÑ Ð¾Ð¿ÑÑÐµÐ½Ñ, ÑÑÐ¾Ð±Ñ Ð½Ðµ ÑÑÐ»Ð¾Ð¶Ð½ÑÑÑ Ð¿ÑÐ¾ÑÑÐµÐ½Ð¸Ðµ. ÐÐ½ Ð²ÑÑÐ¸ÑÐ»ÑÐµÑÑÑ Ñ Ð¿Ð¾Ð¼Ð¾ÑÑÑ 2 ÐºÐ»ÑÑÐµÐ¹, Ð¿ÑÐ¸Ð²Ð°ÑÐ½Ð¾Ð³Ð¾ Ð¸ Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð³Ð¾, Ð¿ÑÑÐµÐ¼ Ð½Ð°ÑÐ¾Ð¶Ð´ÐµÐ½Ð¸Ñ Ð¾Ð±ÑÐµÐ¹ ÑÐ¾ÑÐºÐ¸ Ð½Ð° ÐºÑÐ¸Ð²Ð¾Ð¹. ÐÑÐ»Ð¸ Ð¸Ð½ÑÐµÑÐµÑÐ½Ð¾, ÑÐ¾ Ð»ÑÑÑÐµ Ð¿Ð¾ÑÐ¸ÑÐ°ÑÑ Ð¿ÑÐ¾ ÑÑÐ¾ Ð¾ÑÐ´ÐµÐ»ÑÐ½Ð¾.

[ÐÑÐ¸Ð¼ÐµÑ ÐºÐ¾Ð´Ð°](https://github.com/xssnick/tonutils-go/blob/2b5e5a0e6ceaf3f28309b0833cb45de81c580acc/liteclient/crypto.go#L32)
