# TL

TL (Type Language) - это язык для описания структур данных.

Для структуризации полезных данных, при общении используются [TL схемы](https://github.com/ton-blockchain/ton/tree/master/tl/generate/scheme) 
и в качестве префикса - айди схемы в little endian, который вычисляется, как crc32 с таблицей IEEEE от схемы.

TL оперирует 32 битными блоками. Соответственно размер данных в TL должен быть кратен 4 байтам. 
Если размер объекта не кратен 4, нам нужно добавить нужное количество нулевых байт до кратности. 

Для кодирования чисел всегда используется порядок Little Endian.

Более детально TL можно изучить в [документации Telegram](https://core.telegram.org/mtproto/TL) (опционально)


### Кодирование bytes в TL
Для кодирования массива байт нам нужно сначала определить его размер. 
Если он меньше чем 254 байта, то используется кодирование с 1 байтом в качестве размера. Если больше, 
то в качестве первого байта пишется 0xFE, как индикатор большого массива, и уже после него следуют 3 байта размера.

Например, мы кодируем массив `[0xAA, 0xBB]`, его размер 2. Мы используем 1 байт 
размера и далее пишем сами данные, получаем `[0x02, 0xAA, 0xBB]`, готово, но мы видим, 
что финальный размер равен 3 и не кратен 4м байтам, тогда нам нужно добавить 1 байт паддинга, чтобы было 4. Получаем: `[0x02, 0xAA, 0xBB, 0x00]`.

В случае, если нам нужно закодировать массив, размер которого будет равен, например, 396, 
мы поступаем следующим образом: 396 >= 254, значит мы используем 3 байта для кодирования размера и 1 байт индикатор повышенного размера, 
получаем: `[0xFE, 0x8C, 0x01, 0x00, байты массива]`, 396+4 = 400, что кратно 4, выравнивать не нужно.
